<!DOCTYPE html>
{% load static %}
<html>
<head>
        <title>Test Experiment</title>
        <meta charset="utf-8">
        <script src="{% static 'game/scripts/jspsych.js' %}"></script>
        <script src="{% static 'game/jspsych-6/plugins/jspsych-html-keyboard-response.js' %}"></script>
        <script src="{% static 'game/jspsych-6/plugins/jspsych-html-button-response.js' %}"></script>
        <script src="{% static 'game/jspsych-6/plugins/jspsych-image-button-response.js' %}"></script>
        <script src="{% static 'game/jspsych-6/plugins/jspsych-image-keyboard-response.js' %}"></script>
        <script src="{% static 'game/jspsych-6/plugins/jspsych-audio-button-response.js' %}"></script>
        <script src="{% static 'game/jspsych-6/plugins/jspsych-audio-keyboard-response.js' %}"></script>
        <script src="{% static 'game/jspsych-6/plugins/jspsych-video.js' %}"></script>
        <script src="{% static 'game/jspsych-6/plugins/jspsych-fullscreen.js' %}"></script>
        <script src="{% static 'game/jspsych-6/plugins/jspsych-categorize-html.js' %}"></script>
        <link rel="stylesheet" href="{% static 'game/styles/jspsych.css' %}"></link>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
        </head>

<body>
<script>
var timeline = [];
var start_time_list = [];
var end_time_list = [];
const average = arr => arr.reduce( ( p, c ) => p + c, 0 ) / arr.length;timeline.push({
                        type: 'fullscreen',
                        fullscreen_mode: true
                        });
timeline.push({
type: "html-keyboard-response",
stimulus: 'ï»¿Hello world!<br>This is a test experiment',
stimulus_duration: 3000,
trial_duration: 3000,
choices: jsPsych.NO_KEYS,
});
timeline.push({
type: "html-button-response",
stimulus: '<div style="color:red; font_size:20px;">Which fruit do yon eat?</div>',
trial_duration: 10000,
choices: ['<img src="/upload_files/ymkimtest2/mjgame/img/rr1.png"><br><br>','<img src="/upload_files/ymkimtest2/mjgame/img/yy1.png"><br><br>'],
data: {test_part: "test"},
on_finish: function(data){
                                var current_time = new Date();
                                end_time_list.push(current_time);
                                data.choices = ['<img src="/upload_files/ymkimtest2/mjgame/img/rr1.png"><br><br>','<img src="/upload_files/ymkimtest2/mjgame/img/yy1.png"><br><br>']
                                },
on_load: function(data){
                                var current_time = new Date();
                                start_time_list.push(current_time);
                                },
});
timeline.push({
type: "image-keyboard-response",
stimulus: '/upload_files/ymkimtest2/mjgame/img/fix.png',
stimulus_duration: 2000,
trial_duration: 2000,
choices: jsPsych.NO_KEYS,
});
timeline.push({
type: "image-button-response",
stimulus: '/upload_files/ymkimtest2/mjgame/img/rr1.png',
trial_duration: 10000,
choices: ['eat','don\'t eat'],
data: {test_part: "test"},
on_finish: function(data){
                                var current_time = new Date();
                                end_time_list.push(current_time);
                                data.choices = ['eat','don\'t eat']
                                },
on_load: function(data){
                                var current_time = new Date();
                                start_time_list.push(current_time);
                                },
});
timeline.push({
type: "html-button-response",
stimulus: '<div style="color:blue; font_size:20px;">Which is the previous image?</div>',
trial_duration: 10000,
choices: ['<img src="/upload_files/ymkimtest2/mjgame/img/rr1.png"><br><br>','<img src="/upload_files/ymkimtest2/mjgame/img/yy1.png"><br><br>'],
data: { correct_response: 0, test_part: "test"},
on_finish: function(data){
                                    data.correct = data.button_pressed == data.correct_response;
                                    var current_time = new Date();
                                    end_time_list.push(current_time);
                                    data.choices = ['<img src="/upload_files/ymkimtest2/mjgame/img/rr1.png"><br><br>','<img src="/upload_files/ymkimtest2/mjgame/img/yy1.png"><br><br>']
                                    },
on_load: function(data){
                                    var current_time = new Date();
                                    start_time_list.push(current_time);
                                    },
});
timeline.push({
                        timeline: [{type: 'image-keyboard-response',
stimulus:'/upload_files/ymkimtest2/mjgame/img/cardsorting/correct2.png',
trial_duration:2000
}
],
                        conditional_function: function (data) {
                            var data = jsPsych.data.get().last(1).values()[0];
                            if (data.correct_response == data.button_pressed) {
                                return true;
                            } else {
                                return false;
                            }
                        }
                    });
timeline.push({
                        timeline: [{type: 'image-keyboard-response',
stimulus:'/upload_files/ymkimtest2/mjgame/img/cardsorting/wrong2.png',
trial_duration:2000
}
],
                        conditional_function: function (data) {
                            var data = jsPsych.data.get().last(1).values()[0];
                            if (data.correct_response == data.button_pressed) {
                                return false;
                            } else {
                                return true;
                            }
                        }
                    });
timeline.push({
type: "html-keyboard-response",
stimulus: '<div style="font_size:40px;">Thank you!</div>',
stimulus_duration: 5000,
trial_duration: 5000,
choices: jsPsych.NO_KEYS,
});
timeline.push({
                type: 'html-keyboard-response',
                stimulus: function () {
                                var trials = jsPsych.data.get().filter({ test_part: "test" });
                                if(trials.count() > 0){
                                    var correct_trials = trials.filter({ correct: true });
                                    var accuracy = Math.round(correct_trials.count() / trials.count() * 100);
                                    var rt = trials.select('rt').values;
                                    console.log(accuracy);
                                    console.log(start_time_list);
                                    console.log(end_time_list);
                                    console.log(rt);
                                    return "<p>You responded correctly on " + accuracy + "% of the trials.</p>" +
                                        "<p>Your average response time was " + average(rt) / 1000 + "s.</p>";
}
                                else {
                                    var rt = trials.select('rt').values;
                                    console.log(start_time_list);
                                    console.log(end_time_list);
                                    console.log(rt);
                                    return "<p>Your average response time was " + average(rt) / 1000 + "s.</p>";
}
                            },
                trial_duration: 10000,
                });
jsPsych.init({
			timeline: timeline,
			show_preload_progress_bar: true,
            on_finish: function() {
                jsPsych.data.get().localSave('csv','data.csv');
            }
		});
</script>
</body>
</html>